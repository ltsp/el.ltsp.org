# Εικονικές μηχανές (Virtual Machines)

Η υπηρεσία Τεχνικής Στήριξης συντηρεί τις παρακάτω εικονικές μηχανές ***VirtualBox***:

<<<<<<< HEAD
1.  [Ubuntu Bionic MATE 18.04 **32bit**](https://ts.sch.gr/repo/images/VMs/bionic-mate.squashfs)

2.  [Ubuntu Focal MATE 20.04 **64bit**](https://ts.sch.gr/repo/images/VMs/focal-mate.squashfs)
=======
1.  [Ubuntu Focal MATE 20.04 **64 bit**](https://ts.sch.gr/repo/images/VMs/focal-mate.squashfs)

2.  [Ubuntu Bionic MATE 18.04 **32 bit**](https://ts.sch.gr/repo/images/VMs/bionic-mate.squashfs)
>>>>>>> 99d69ec85649d9daf1a2d7018e58f0e7111207c2

Αυτές μπορούν να φανούν χρήσιμες στα παρακάτω σενάρια:

-   Για χρήση εντός του VirtualBox:
    - στην περίπτωση που έχετε LTSP server με λειτουργικό 64bit και θέλετε
      να εκκινήσετε και 32bit clients,
    - ή απλά για δοκιμές.
-   Για εγγραφή σε πραγματικό δίσκο και χρήση σε φυσικό μηχάνημα (χωρίς
    VirtualBox), αντί να γίνει εξ' αρχής εγκατάσταση από live USB.

<<<<<<< HEAD
-   Αν έχετε μικτό εργαστήριο 32/64bit clients, ως **εικονικό** 32bit Λ.Σ.
    (***VirtualBox***) μέσα σε **πραγματικό** 64bit LTSP server, χωρίς έτσι να
    χρειάζεται η αγορά/ύπαρξη δεύτερου πραγματικού LTSP server.
=======
## Χρήση εντός του VirtualBox {:#virtualbox}
>>>>>>> 99d69ec85649d9daf1a2d7018e58f0e7111207c2

Εάν έχετε LTSP server με λειτουργικό σύστημα 64bit, με τα ακόλουθα βήματα θα
μπορείτε να εκκινήσετε και 32bit LTSP clients.

<<<<<<< HEAD
## Λ.Σ. δοκιμών (VirtualBox) {:#virtualbox}

Για να κάνετε χρήση της έτοιμης εικονικής μηχανής π.χ. της Ubuntu Bionic MATE
20.04 **32bit**, θα πρέπει να ακολουθήσετε τα επόμενα βήματα:

1.  Από [τερματικό](../../glossary#terminal):
=======
1.  Από [τερματικό](../../glossary#terminal) κατεβάστε και αποσυμπιέστε το
    σχετικό αρχείο:
>>>>>>> 99d69ec85649d9daf1a2d7018e58f0e7111207c2

    ```shell
    mkdir -p ~/"VirtualBox VMs"
    cd ~/"VirtualBox VMs"
<<<<<<< HEAD
    # Download της συμπιεσμένης εικονικής μηχανής.
    wget https://ts.sch.gr/repo/images/VMs/bionic-mate.squashfs
    # Αποσυμπίεση στο φάκελο VirtualBox VMs/bionic-mate.
    unsquashfs -f -d bionic-mate bionic-mate.squashfs
    ```

    !!! tip ""
        Αν χρειαστείτε την `focal-mate`, στις εντολές όπου `bionic-mate`
        αντικαταστήστε με `focal-mate`.

2.  [Εγκατάσταση](../../ubuntu/software.md) του ***VirtualBox***. Μόλις
    ολοκληρωθεί η εγκατάσταση, θα το βρείτε στο ***Εφαρμογές*** ▸ ***Εργαλεία
    συστήματος*** ▸ ***VirtualBox***.

    !!! tip ""
        Για να εμφανιστεί στο μενού το ***VirtualBox*** θα πρέπει να κάνετε
        ***Αποσύνδεση*** και να επανασυνδεθείτε.

3.  Εισαγωγή της εικονικής μηχανής `bionic-mate.vbox` στο VirtualBox από το
    μενού: ***Μηχανή*** ▸ ***Προσθήκη...*** ή με **`Ctrl`**+**`A`**.
=======
    wget https://ts.sch.gr/repo/images/VMs/bionic-mate.squashfs
    unsquashfs -f -d bionic-mate bionic-mate.squashfs
    rm bionic-mate.squashfs
    ```

2.  [Εγκαταστήστε](../../ubuntu/software.md) το πακέτο virtualbox. Μόλις
    ολοκληρωθεί η εγκατάσταση, θα το βρείτε στο ***Εφαρμογές*** ▸ ***Εργαλεία
    συστήματος*** ▸ ***VirtualBox***.

3.  Από το μενού ***Μηχανή*** ▸ ***Προσθήκη...*** του VirtualBox, περιηγηθείτε
    στον φάκελο `~/VirtualBox VMs/bionic-mate` και επιλέξετε το αρχείο
    `bionic-mate.vbox`.
>>>>>>> 99d69ec85649d9daf1a2d7018e58f0e7111207c2

4.  Ελέγξτε τις ***Ρυθμίσεις*** της εικονικής μηχανής, για παράδειγμα ότι η
    μνήμη RAM **RAM** είναι εντός των προτεινόμενων ορίων, και τελικά πατήστε
    ***Εκκίνηση***.

    [![](VT-x_BIOS.png)](VT-x_BIOS.png)

    !!! tip "Πληροφορία"
        Σε περίπτωση που κατά την ***Εκκίνηση*** εμφανιστεί το μήνυμα της
        διπλανής εικόνας, θα πρέπει από το BIOS/UEFI να ενεργοποιήσετε την
        επιλογή ***Intel Virtualization Technology (VT-x)***. Το αντίστοιχο
        μήνυμα για AMD CPU θα είναι: `AMD-V is disabled in the BIOS`.

<<<<<<< HEAD
## Υποστήριξη 32bit clients σε LTSP server 64bit, με χρήση εικονικής μηχανής (VirtualBox) {:#vm-support-32bit-clients}

### Σενάριο

Έχετε ήδη εγκαταστημένο LTSP server **64bit** και θέλετε να υποστηρίξετε **και
32bit clients**. Λόγω αρχιτεκτονικής **τα 32bit clients δεν μπορούν να
εξυπηρετηθούν από τον 64bit εικονικό δίσκο**, που ήδη χρησιμοποιείτε για τα
64bit clients του εργαστηρίου σας. Η λύση σε αυτό είναι η χρήση εικονικής
μηχανής 32bit (`VirtualBox`).

Ουσιαστικά **θα συντηρείτε δύο Ubuntu MATE**. To 64bit του LTSP server σας και
το 32bit της εικονικής μηχανής. Για τα 64bit clients δεν αλλάζει κάτι, θα
συνεχίσουν να εξυπηρετούνται από τον εικονικό δίσκο του LTSP server. Τα 32bit
clients όμως θα εξυπηρετούνται από 32bit εικονικό δίσκο `.img` τον οποίο θα
δημιουργείτε απο τον τοπικό δίσκο της εικονικής μηχανής `.vmdk`.

### Προϋποθέσεις

-   Λειτουργικό εργαστήριο με LTSP server με **64bit clients**.
-   **32bit client(s)** με τις προτεινόμενες
    [προδιαγραφές](../../ltsp/requirements.md).

### Βήματα υλοποίησης

1.  Ακολουθείτε χωρίς αλλαγές τον οδηγό [Λ.Σ. δοκιμών
    (VirtualBox)](#virtualbox), ώστε να έχετε στον **64bit** LTSP
    server σας, μια Bionic MATE **32bit** εικονική μηχανή.

    !!! info "Πληροφορία"

        -   Η εικονική μηχανή **δε συμμετέχει στο τοπικό δίκτυο** του εργαστηρίου
            γι' αυτο και **δε χρειάζεται αλλαγές στις ρυθμίσεις δικτύου της**. Έχει
            πρόσβαση στο διαδίκτυο, αλλά βρίσκεται σε άλλο υποδίκτυο (NAT).

        -   Αν και στην εικονική μηχανή θα βρείτε προεγκατεστημένα τον ***Επόπτη*** και
            τη ***Διαχείριση ΣΕΠΕΗΥ*** τα αγνοείτε. **Η διαχείριση του εργαστηρίου και
            των χρηστών συνεχίζει να γίνεται απο τον 64bit LTSP server**.

2.  Με **κλειστή** την εικονική μηχανή, από [τερματικό](../../glossary#terminal):

    ```shell
    # Κατάλληλη "σύνδεση" του x86_32.img, ώστε να δημιουργείται από το bionic-mate-flat.vmdk
    sudo ln -rs $HOME/VirtualBox\ VMs/bionic-mate/bionic-mate-flat.vmdk /srv/ltsp/x86_32.img
    # Δημοσίευση εικονικού δίσκου x86_32.img
    sudo ltsp image x86_32
    # Ενημέρωση των καταχωρήσεων στο μενού του ipxe.
    sudo ltsp ipxe
    ```

    Για να επιβεβαιώσετε ότι πλέον έχετε δύο εικονικούς δίσκους (x86_32/x86_64):

    ```shell-session
    $ sudo ls -lR /srv/ltsp
    /srv/ltsp:
    σύνολο 8
    drwx------ 2 root root 4096 Απρ   2 12:28 images
    lrwxrwxrwx 1 root root   73 Απρ   2 12:23 x86_32.img -> '../../home/administrator/VirtualBox VMs/bionic-mate/bionic-mate-flat.vmdk'

    /srv/ltsp/images:
    σύνολο 4336212
    -rw-r--r-- 1 root root 2395348992 Απρ   2 12:28 x86_32.img
    -rw-r--r-- 1 root root 2044923904 Μαρ  16 18:21 x86_64.img
    ```

Αν όλα έχουν πάει σωστά, ανάλογα ποιας αρχιτεκτονικής client θα εκκινείτε, θα
επιλέγεται αυτόματα ο κατάλληλος εικονικός δίσκος.

!!! warning "Προσοχή"
    Να φροντίζετε ώστε η εικονική μηχανή να έχει εγκατεστημένα τα ίδια
    λογισμικά με τον LTSP server, έτσι ώστε οι χρήστες, ανεξάρτητα ποιας
    αρχιτεκτονικής clients (32/64bit) θα χρησιμοποιούν, να έχουν διαθέσιμα τα
    ίδια προγράμματα/μενού. Στη συνέχεια, πάντα με κλειστή την εικονική μηχανή,
    δημοσίευση του 32bit εικονικού δίσκου: `sudo ltsp image x86_32`.

*Πηγή αγγλικής τεκμηρίωσης: <https://ltsp.org/man/ltsp/#examples>*

## Μετατροπή εικονικού δίσκου (vmdk), σε πραγματικό (partition) - Κλωνοποίηση μέσω τοπικού δικτύου (LTSP) {:#vmdk-partition-lan-ltsp}

### Σενάριο

Έχετε ήδη εγκαταστημένο LTSP server και θέλετε να εγκαταστήσετε Ubuntu MATE σε
υπολογιστή μέσω του τοπικού δικτύου, έτσι ώστε στη συνέχεια, να τον
χρησιμοποιήσετε ως standalone θέση εργασίας ή να τον μετατρέψετε σε LTSP
server.

### Προϋποθέσεις

-   Λειτουργικός LTSP server.
-   Τοπικό δίκτυο. Προτείνεται στα 1000 Mbps έτσι ώστε να γίνει πολύ γρήγορα η
    εγγραφή του εικονικού.
-   Υπολογιστής "στόχος" με τις προτεινόμενες
    [προδιαγραφές](../../ltsp/requirements.md).
-   Κατάλληλες ρυθμίσεις στο BIOS "στόχου", ώστε να είναι σε BIOS mode (ή
    UEFI/legacy mode), γιατί και ο εικονικός `.vmdk` είναι σε BIOS/MBR mode.
-   Συμπιεσμένη εικονική μηχανή `.squashfs` μέσα στο φάκελο `VirtualBox VMs`.

    !!! warning "Προσοχή"
        **Μόνο την "κατεβάζετε", δεν αποσυμπιέζετε** το `.squashfs`, γιατί
        μπορεί να σας κάνει overwrite προϋπάρχουσα εικονική μηχανή. Η λήψη
        μπορεί να γίνει και όπως περιγράφετε στο 1ο βήμα της ενότητας [Λ.Σ.
        δοκιμών (VirtualBox)](#virtualbox).

### Βήματα υλοποίησης

1.  [Εκκίνηση από το δίκτυο](../../ltsp/netboot.md) του υπολογιστή "στόχου".

2.  Σύνδεση ως `administrator` στον υπολογιστή "στόχο".

3.  Από [τερματικό](../../glossary#terminal) π.χ. ως `administrator@ltsp147`:
=======
5.  Κάθε φορά που θέλετε να εγκαταστήσετε νέα προγράμματα θα πρέπει να τα
    εγκαθιστάτε δύο φορές, μία εκτός και μία εντός του VirtualBox. Όμως δεν
    χρειάζεται να προσθέσετε λογαριασμούς χρηστών εντός του VirtualBox, θα
    χρησιμοποιηθούν οι χρήστες του φυσικού LTSP server.
>>>>>>> 99d69ec85649d9daf1a2d7018e58f0e7111207c2

6.  Κλείστε την εικονική μηχανή. Ειδοποιήστε το LTSP για τον νέο εικονικό δίσκο
    προσθέσατε και κάντε δημοσίευση δίνοντας τις παρακάτω εντολές σε ένα
    τερματικό:

    ```shell
    sudo ln -s "/home/administrator/VirtualBox VMs/bionic-mate/bionic-mate-flat.vmdk" /srv/ltsp/x86_32.img
    sudo ltsp image x86_32
    sudo ltsp ipxe
    ```

7.  Τις επόμενες φορές που θα χρειαστείτε δημοσίευση, για τον 32bit εικονικό
    δίσκο χρησιμοποιήστε μόνο την μεσαία από τις 3 παραπάνω εντολές (`sudo ltsp
    image x86_32`), ενώ για τον 64bit το [σχετικό μενού της Διαχείρισης
    ΣΕΠΕΗΥ](../..//ltsp/ltsp-commands/#ltsp-image).

!!! tip "Πληροφορία"
    Εάν θέλετε να κατεβάσετε την εικονική μηχανή 64bit π.χ. για δοκιμές εντός
    του VirtualBox, ακολουθήστε τις παραπάνω οδηγίες εκτός από τα βήματα 6 και
    7. Επίσης, όπου αναφέρεται η λέξη `bionic` αντικαταστήστε την με την λέξη
    `focal`.

## Εγγραφή σε δίσκο {:#disk}

Ακολουθώντας τις οδηγίες της προηγούμενης παραγράφου μπορείτε να εισάγετε τις
εικονικές μηχανές στο VirtualBox. Ας δούμε τώρα πώς μπορείτε να τις
κλωνοποιήσετε σε φυσικούς υπολογιστές. Πιθανά σενάρια:

- Ένας υπεύθυνος ΠΛΗΝΕΤ θέλει να κλωνοποιεί στα γρήγορα το Ubuntu(/LTSP) στους
  σχολικούς servers που του φέρνουν στο γραφείο.
- Ένας υπεύθυνος ΣΕΠΕΗΥ θέλει να γράψει ένα τοπικό λειτουργικό σε όλους τους
  σταθμούς εργασίας, για την περίπτωση που χαλάσει ο LTSP server.

1.  Ξεκινήστε τον "υπολογιστή στόχο" [από το δίκτυο](../../ltsp/netboot.md).

2.  Συνδεθείτε ως `administrator`, ώστε να έχετε άμεση πρόσβαση στις εικονικές
    μηχανές που βρίσκονται στο home directory σας.

3.  Από [τερματικό](../../glossary#terminal) π.χ. ως `administrator@ltsp147`
    δώστε:

    !!! warning "Προσοχή"
        Η εντολή `dd` **διαγράφει οριστικά όλα** τα δεδομένα του δίσκου στόχου!

    ```shell
    # Λήψη δικαιωμάτων διαχειριστή
    sudo -i
    # Απενεργοποίηση των swap partitions ώστε να μην είναι σε χρήση
    swapoff -a
    # Εύρεση του ονόματος του δίσκου-στόχου. Στις επόμενες εντολές
    # αντικαταστήστε το παράδειγμα /dev/sdx με το όνομα που είδατε.
    lsblk --fs
    # Αποπροσάρτηση όλων των partitions του
    umount /dev/sdx?
    # Περιήγηση στον φάκελο όπου βρίσκεται η εικονική μηχανή
    cd "/home/administrator/VirtualBox VMs/bionic-mate"
    # Εγγραφή στον δίσκο
    dd if=bionic-mate-flat.vmdk of=/dev/sdx bs=1M status=progress
    # Εκκίνηση του gparted
    gparted /dev/sdx
    ```

4.  Από το παράθυρο του [GParted](../gparted/index.md) που άνοιξε:

    1.  **Μετακινήστε** το swap partition ***/dev/sdx2*** στο τέλος του δίσκου
        και ταυτόχρονα αλλάξτε το μέγεθός του σε 4100 MB. Πατήστε
        ***![](../gparted/Gparted-apply-new-partition.png#inline) Εφαρμογή όλων
        των εργασιών***.

    2.  **Αυξήστε** το μεγέθους του Linux partition ***/dev/sdx1*** ώστε να
        καταλαμβάνει όλο τον διαθέσιμο δίσκο και ξαναπατήστε
        ***![](../gparted/Gparted-apply-new-partition.png#inline) Εφαρμογή
        όλων των εργασιών***.

Ο υπολογιστής-στόχος είναι έτοιμος. Μπορείτε να κάνετε επανεκκίνηση ώστε να
ελέγξετε ότι είναι λειτουργικός.

!!! info "Πληροφορία"
    Η κλωνοποίηση μπορεί να είναι χρήσιμη σε πολύ περισσότερα σενάρια πέρα από
    το LTSP, για παράδειγμα η πηγή μπορεί να είναι ένα live USB stick ή ο
    προορισμός ένας δίσκος σε θήκη USB. Για περισσότερες πληροφορίες / απορίες
    / διευκρινήσεις επισκεφτείτε:

    -   [Κλωνοποίηση εγκαταστάσεων Linux/Windows](https://alkisg.mysch.gr/steki/index.php?topic=7658.0)
    -   [Κλωνοποίηση δίσκου UEFI](https://alkisg.mysch.gr/steki/index.php?topic=8762.0)
    -   [Απομακρυσμένη κλωνοποίηση δίσκου από ΠΛΗΝΕΤ σε
        σχολείο](https://alkisg.mysch.gr/steki/index.php?topic=8602.0)
