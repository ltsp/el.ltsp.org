# Εικονικές μηχανές (Virtual Machines)

Η Τ.Σ. του Π.Σ.Δ. έχει δημιουργήσει και συντηρεί έτοιμες εικονικές
μηχανές:

1.  [Ubuntu Bionic MATE 18.04 **32 bit**](https://ts.sch.gr/repo/images/VMs/bionic-mate.squashfs)

2.  [Ubuntu Focal MATE 20.04 **64 bit**](https://ts.sch.gr/repo/images/VMs/focal-mate.squashfs)

τις οποίες μπορείτε να χρησιμοποιείτε με διάφορους τρόπους, όπως:

-   Ως Λειτουργικό Σύστημα (Λ.Σ.) δοκιμών (***VirtualBox***) μέσα στο
    πραγματικό Λ.Σ. που ήδη έχετε.

-   Αν έχετε μικτό εργαστήριο 32/64 bit clients, ως **εικονικό** 32 bit LTSP
    server (***VirtualBox***) μέσα σε **πραγματικό** 64 bit LTSP server, χωρίς
    έτσι να χρειάζεται η αγορά/ύπαρξη δεύτερου πραγματικού LTSP server.

-   Ως το κύριο Λ.Σ., μετατρέποντας τον εικονικό σκληρό δίσκο `.vmdk`, σε
    πραγματικό partition του σκληρού σας δίσκου (**Κλωνοποίηση**).

## Λ.Σ. δοκιμών (VirtualBox) {:#virtualbox}

Για να κάνετε χρήση της έτοιμης εικονικής μηχανής π.χ. της Ubuntu Focal MATE
20.04 **64 bit**, θα πρέπει να ακολουθήσετε τα επόμενα βήματα:

1.  Από [τερματικό](../../glossary#terminal), την "κατεβάζετε" σε συμπιεσμένη
    μορφή στο φάκελο `VirtualBox VMs` και την αποσυμπιέζετε στο φάκελο
    `VirtualBox VMs/focal-mate`:

    ```shell
    mkdir -p ~/"VirtualBox VMs"
    cd ~/"VirtualBox VMs"
    wget https://ts.sch.gr/repo/images/VMs/focal-mate.squashfs
    unsquashfs -f -d focal-mate focal-mate.squashfs
    ```

    !!! tip ""
        Αν χρειαστείτε και την `bionic-mate`, στις εντολές όπου `focal-mate`
        αντικαταστήστε με `bionic-mate`.

2.  [Εγκατάσταση](../../ubuntu/software.md) του ***VirtualBox***. Μόλις
    ολοκληρωθεί η εγκατάσταση, θα το βρείτε στο ***Εφαρμογές*** ▸ ***Εργαλεία
    συστήματος*** ▸ ***VirtualBox***.

    !!! tip ""
        Για να εμφανιστεί στο μενού το ***VirtualBox*** θα πρέπει να κάνετε
        ***Αποσύνδεση*** και να επανασυνδεθείτε.

3.  Εισαγωγή της εικονικής μηχανής `focal-mate.vbox` στο VirtualBox από το
    μενού: ***Μηχανή*** ▸ ***Προσθήκη...*** ή με **`Ctrl`**+**`A`**.

    !!! tip ""
        Το αρχείο `.vbox` βρίσκεται μέσα στον αντίστοιχο φάκελο του `VirtualBox
        VMs`.

4.  Πριν επιλέξετε ***Εκκίνηση*** θα πρέπει να ελέγξετε τις ***Ρυθμίσεις*** της
    εικονικής μηχανής. Το κυριότερο είναι το μέγεθος της μνήμης **RAM** να
    είναι στα **προτεινόμενα όρια**.

    [![](VT-x_BIOS.png)](VT-x_BIOS.png)
    !!! tip "Χρήσιμο"
        Σε περίπτωση που κατά την ***Εκκίνηση*** εμφανιστεί το μήνυμα της
        διπλανής εικόνας, θα πρέπει από το BIOS/UEFI να ενεργοποιήσετε την
        επιλογή ***Intel Virtualization Technology (VT-x)***. Το αντίστοιχο
        μήνυμα για AMD CPU θα είναι: `AMD-V is disabled in the BIOS`.

## Μετατροπή εικονικού δίσκου (vmdk), σε πραγματικό (partition) - Κλωνοποίηση μέσω τοπικού δικτύου (LTSP) {:#vmdk-partition-lan-ltsp}

### Σενάριο

Έχετε ήδη εγκαταστημένο LTSP server και θέλετε να εγκαταστήσετε Ubuntu MATE σε
υπολογιστή μέσω του τοπικού δικτύου έτσι ώστε στη συνέχεια να τον
χρησιμοποιήσετε ως standalone θέση εργασίας ή να τον μετατρέψετε σε LTSP
server.

### Προϋποθέσεις

-   Λειτουργικός LTSP server.
-   Τοπικό δίκτυο. Προτείνεται στα 1000 Mbps έτσι ώστε να γίνει πολύ γρήγορα η
    εγγραφή του εικονικού.
-   Υπολογιστής "στόχος" με τις προτεινόμενες
    [προδιαγραφές](../../ltsp/requirements.md).
-   Κατάλληλες ρυθμίσεις στο BIOS "στόχου", ώστε να είναι σε BIOS mode (ή
    UEFI/legacy mode), γιατί και ο εικονικός `.vmdk` είναι σε BIOS/MBR mode.
-   Συμπιεσμένη εικονική μηχανή `.squashfs` μέσα στο φάκελο `VirtualBox VMs`.

    !!! warning "Προσοχή"
        **Μόνο την "κατεβάζετε", δεν αποσυμπιέζετε** το `.squashfs`, γιατί
        μπορεί να σας κάνει overwrite προϋπάρχουσα εικονική μηχανή. Η λήψη
        μπορεί να γίνει και όπως περιγράφετε στο 1ο βήμα της ενότητας [Λ.Σ.
        δοκιμών (VirtualBox)](#virtualbox).

### Βήματα υλοποίησης

1.  [Εκκίνηση από το δίκτυο](../../ltsp/netboot.md) του υπολογιστή "στόχου".

2.  Σύνδεση ως `administrator` στον υπολογιστή "στόχο".

3.  Από [τερματικό](../../glossary#terminal) π.χ. ως `administrator@ltsp147`:

    !!! warning "Προσοχή"
        Η εντολή `dd` διαγράφει **όλα** τα δεδομένα του δίσκου **οριστικά**!!!

    ```shell
    # Απενεργοποίηση τυχόν τοπικών swap files.
    sudo swapoff -a
    # Εύρεση του "ονόματος" του τοπικού δίσκου (π.χ. sda).
    lsblk --fs
    # Προσάρτηση του .squashfs π.χ. για το focal-mate:
    udisksctl loop-setup -f ~/"VirtualBox VMs"/focal-mate.squashfs
    # Εγγραφή του .vmdk, στον τοπικό δίσκο π.χ. για sda:
    sudo dd if=/media/$USER/disk/focal-mate-flat.vmdk of=/dev/sda bs=1M status=progress
    # Αποπροσάρτηση του .squashfs
    umount /media/$USER/disk
    ```

4.  **Χωρίς** να κάνετε **επανεκκίνηση** τον υπολογιστή "στόχο" συνεχίζεται στο
    τερματικό π.χ. για `/dev/sda`:

    ```shell
    gparted /dev/sda
    ```

    Στο [GParted](../gparted/index.md) πρέπει να γίνουν δύο βασικές ενέργειες:

    1.  **Αύξηση** του μεγέθους του swap partition ***/dev/sda2*** σε 4100 MB
        και **μετακίνηση** του στο τέλος του δίσκου. **Πριν** το επόμενο βήμα
        να γίνει ***Εφαρμογή όλων των εργασιών*** (εικονίδιο
        ![](../gparted/Gparted-apply-new-partition.png#inline)).

    2.  **Αύξηση** του μεγέθους του linux partition ***/dev/sda1*** ώστε να
        καταλαμβάνει όλο το διαθέσιμο δίσκο και ***Εφαρμογή όλων των
        εργασιών*** (εικονίδιο
        ![](../gparted/Gparted-apply-new-partition.png#inline)).

Ο υπολογιστής "στόχος" είναι έτοιμος. Μπορείτε να κάνετε επανεκκίνηση ώστε να
ελέγξετε ότι είναι λειτουργικός.

## Μετατροπή εικονικού δίσκου (vmdk), σε πραγματικό (partition) - Κλωνοποίηση μέσω τοπικού μέσου (Live USB) {:#vmdk-partition-liveusb}

### Σενάριο

Θέλετε να εγκαταστήσετε Ubuntu MATE σε υπολογιστή μέσω τοπικού μέσου (π.χ. Live
USB) έτσι ώστε στη συνέχεια να τον χρησιμοποιήσετε ως standalone θέση εργασίας
ή να τον μετατρέψετε σε LTSP server.

### Προϋποθέσεις

-   [Live USB](../../ubuntu/liveusb.md).
-   [Συμπιεσμένη εικονική μηχανή](index.md) `.squashfs`, στον αρχικό κατάλογο
    `/` του Live USB.
-   Υπολογιστής "στόχος" με τις προτεινόμενες
    [προδιαγραφές](../../ltsp/requirements.md).
-   Κατάλληλες ρυθμίσεις στο BIOS "στόχου", ώστε να είναι σε BIOS mode (ή
    UEFI/legacy mode), γιατί και ο εικονικός `.vmdk` είναι σε BIOS/MBR mode.

### Βήματα υλοποίησης

1.  Εκκίνηση του υπολογιστή "στόχου" με τη χρήση του Live USB.

    !!! tip ""
        Για την εκκίνηση από Live USB ισχύει ότι και στην
        [Εγκατάσταση](../../ubuntu/installation.md) του Ubuntu.

2.  Από [τερματικό](../../glossary#terminal):

    !!! warning "Προσοχή"
        Η εντολή `dd` διαγράφει **όλα** τα δεδομένα του δίσκου **οριστικά**!!!

    ```shell
    sudo -i
    # Απενεργοποίηση τυχόν τοπικών swap files.
    swapoff -a
    # Εύρεση του "ονόματος" του τοπικού δίσκου (π.χ. sda).
    lsblk --fs
    # Προσάρτηση του .squashfs π.χ. για το focal-mate:
    udisksctl loop-setup -f /isodevice/focal-mate.squashfs
    # To /dev/loop6 της επόμενης εντολής προκύπτει απο το αποτέλεσμα της loop-setup.
    udisksclt mount -b /dev/loop6
    # Εγγραφή του .vmdk, στον τοπικό δίσκο π.χ. για sda:
    dd if=/media/$USER/disk/focal-mate-flat.vmdk of=/dev/sda bs=1M status=progress
    # Αποπροσάρτηση του .squashfs
    umount /media/$USER/disk
    ```

3.  **Χωρίς** να κάνετε **επανεκκίνηση** τον υπολογιστή "στόχο" συνεχίζεται στο
    τερματικό π.χ. για `/dev/sda`:

    ```shell
    gparted /dev/sda
    ```

    Στο [GParted](../gparted/index.md) πρέπει να γίνουν δύο βασικές ενέργειες:

    1.  **Αύξηση** του μεγέθους του swap partition ***/dev/sda2*** σε 4100 MB
        και **μετακίνηση** του στο τέλος του δίσκου. **Πριν** το επόμενο βήμα
        να γίνει ***Εφαρμογή όλων των εργασιών*** (εικονίδιο
        ![](../gparted/Gparted-apply-new-partition.png#inline)).

    2.  **Αύξηση** του μεγέθους του linux partition ***/dev/sda1*** ώστε να
        καταλαμβάνει όλο το διαθέσιμο δίσκο και ***Εφαρμογή όλων των
        εργασιών*** (εικονίδιο
        ![](../gparted/Gparted-apply-new-partition.png#inline)).

Ο υπολογιστής "στόχος" είναι έτοιμος. Μπορείτε να κάνετε επανεκκίνηση ώστε να
ελέγξετε ότι είναι λειτουργικός.

!!! info "Πληροφορία"
    Ο οδηγός των διαφόρων μεθόδων κλωνοποίησης θα ενημερώνεται συνεχώς. Για περισσοτερες πληροφορίες/λύσεις/απορίες δείτε:

    -   [Κλωνοποίηση εγκαταστάσεων Linux/Windows](https://alkisg.mysch.gr/steki/index.php?topic=7658.0)
    -   [Κλωνοποίηση δίσκου UEFI](https://alkisg.mysch.gr/steki/index.php?topic=8762.0)
    -   [Απομακρυσμένη κλωνοποίηση δίσκου από ΠΛΗΝΕΤ σε
        σχολείο](https://alkisg.mysch.gr/steki/index.php?topic=8602.0)
