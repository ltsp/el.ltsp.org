# Εικονικές μηχανές (Virtual Machines)

Η υπηρεσία Τεχνικής Στήριξης συντηρεί τις παρακάτω εικονικές μηχανές ***VirtualBox***:

1.  [Ubuntu Focal MATE 20.04 **64 bit**](https://ts.sch.gr/repo/images/VMs/focal-mate.squashfs)

2.  [Ubuntu Bionic MATE 18.04 **32 bit**](https://ts.sch.gr/repo/images/VMs/bionic-mate.squashfs)

Αυτές μπορούν να φανούν χρήσιμες στα παρακάτω σενάρια:

-   Για χρήση εντός του VirtualBox:
    - στην περίπτωση που έχετε LTSP server με λειτουργικό 64bit και θέλετε
      να εκκινήσετε και 32bit clients,
    - ή απλά για δοκιμές.
-   Για εγγραφή σε πραγματικό δίσκο και χρήση σε φυσικό μηχάνημα (χωρίς
    VirtualBox), αντί να γίνει εξ' αρχής εγκατάσταση από live USB.

## Χρήση εντός του VirtualBox {:#virtualbox}

Εάν έχετε LTSP server με λειτουργικό σύστημα 64bit, με τα ακόλουθα βήματα θα
μπορείτε να εκκινήσετε και 32bit LTSP clients.

1.  Από [τερματικό](../../glossary#terminal) κατεβάστε και αποσυμπιέστε το
    σχετικό αρχείο:

    ```shell
    mkdir -p ~/"VirtualBox VMs"
    cd ~/"VirtualBox VMs"
    wget https://ts.sch.gr/repo/images/VMs/bionic-mate.squashfs
    unsquashfs -f -d bionic-mate bionic-mate.squashfs
    rm bionic-mate.squashfs
    ```

2.  [Εγκαταστήστε](../../ubuntu/software.md) το πακέτο virtualbox. Μόλις
    ολοκληρωθεί η εγκατάσταση, θα το βρείτε στο ***Εφαρμογές*** ▸ ***Εργαλεία
    συστήματος*** ▸ ***VirtualBox***.

3.  Από το μενού ***Μηχανή*** ▸ ***Προσθήκη...*** του VirtualBox, περιηγηθείτε
    στον φάκελο `~/VirtualBox VMs/bionic-mate` και επιλέξετε το αρχείο
    `bionic-mate.vbox`.

4.  Ελέγξτε τις ***Ρυθμίσεις*** της εικονικής μηχανής, για παράδειγμα ότι η
    μνήμη RAM **RAM** είναι εντός των προτεινόμενων ορίων, και τελικά πατήστε
    ***Εκκίνηση***.

    [![](VT-x_BIOS.png)](VT-x_BIOS.png)

    !!! tip "Πληροφορία"
        Σε περίπτωση που κατά την ***Εκκίνηση*** εμφανιστεί το μήνυμα της
        διπλανής εικόνας, θα πρέπει από το BIOS/UEFI να ενεργοποιήσετε την
        επιλογή ***Intel Virtualization Technology (VT-x)***. Το αντίστοιχο
        μήνυμα για AMD CPU θα είναι: `AMD-V is disabled in the BIOS`.

5.  Κάθε φορά που θέλετε να εγκαταστήσετε νέα προγράμματα θα πρέπει να τα
    εγκαθιστάτε δύο φορές, μία εκτός και μία εντός του VirtualBox. Όμως δεν
    χρειάζεται να προσθέσετε λογαριασμούς χρηστών εντός του VirtualBox, θα
    χρησιμοποιηθούν οι χρήστες του φυσικού LTSP server.

6.  Κλείστε την εικονική μηχανή. Ειδοποιήστε το LTSP για τον νέο εικονικό δίσκο
    προσθέσατε και κάντε δημοσίευση δίνοντας τις παρακάτω εντολές σε ένα
    τερματικό:

    ```shell
    sudo ln -s "/home/administrator/VirtualBox VMs/bionic-mate/bionic-mate-flat.vmdk" /srv/ltsp/x86_32.img
    sudo ltsp image x86_32
    sudo ltsp ipxe
    ```

7.  Τις επόμενες φορές που θα χρειαστείτε δημοσίευση, για τον 32bit εικονικό
    δίσκο χρησιμοποιήστε μόνο την μεσαία από τις 3 παραπάνω εντολές (`sudo ltsp
    image x86_32`), ενώ για τον 64bit το [σχετικό μενού της Διαχείρισης
    ΣΕΠΕΗΥ](../..//ltsp/ltsp-commands/#ltsp-image).

!!! tip "Πληροφορία"
    Εάν θέλετε να κατεβάσετε την εικονική μηχανή 64bit π.χ. για δοκιμές εντός
    του VirtualBox, ακολουθήστε τις παραπάνω οδηγίες εκτός από τα βήματα 6 και
    7. Επίσης, όπου αναφέρεται η λέξη `bionic` αντικαταστήστε την με την λέξη
    `focal`.

## Εγγραφή σε δίσκο {:#disk}

Ακολουθώντας τις οδηγίες της προηγούμενης παραγράφου μπορείτε να εισάγετε τις
εικονικές μηχανές στο VirtualBox. Ας δούμε τώρα πώς μπορείτε να τις
κλωνοποιήσετε σε φυσικούς υπολογιστές. Πιθανά σενάρια:

- Ένας υπεύθυνος ΠΛΗΝΕΤ θέλει να κλωνοποιεί στα γρήγορα το Ubuntu(/LTSP) στους
  σχολικούς servers που του φέρνουν στο γραφείο.
- Ένας υπεύθυνος ΣΕΠΕΗΥ θέλει να γράψει ένα τοπικό λειτουργικό σε όλους τους
  σταθμούς εργασίας, για την περίπτωση που χαλάσει ο LTSP server.

1.  Ξεκινήστε τον "υπολογιστή στόχο" [από το δίκτυο](../../ltsp/netboot.md).

2.  Συνδεθείτε ως `administrator`, ώστε να έχετε άμεση πρόσβαση στις εικονικές
    μηχανές που βρίσκονται στο home directory σας.

3.  Από [τερματικό](../../glossary#terminal) π.χ. ως `administrator@ltsp147`
    δώστε:

    !!! warning "Προσοχή"
        Η εντολή `dd` **διαγράφει οριστικά όλα** τα δεδομένα του δίσκου στόχου!

    ```shell
    # Λήψη δικαιωμάτων διαχειριστή
    sudo -i
    # Απενεργοποίηση των swap partitions ώστε να μην είναι σε χρήση
    swapoff -a
    # Εύρεση του ονόματος του δίσκου-στόχου. Στις επόμενες εντολές
    # αντικαταστήστε το παράδειγμα /dev/sdx με το όνομα που είδατε.
    lsblk --fs
    # Αποπροσάρτηση όλων των partitions του
    umount /dev/sdx?
    # Περιήγηση στον φάκελο όπου βρίσκεται η εικονική μηχανή
    cd "/home/administrator/VirtualBox VMs/bionic-mate"
    # Εγγραφή στον δίσκο
    dd if=bionic-mate-flat.vmdk of=/dev/sdx bs=1M status=progress
    # Εκκίνηση του gparted
    gparted /dev/sdx
    ```

4.  Από το παράθυρο του [GParted](../gparted/index.md) που άνοιξε:

    1.  **Μετακινήστε** το swap partition ***/dev/sdx2*** στο τέλος του δίσκου
        και ταυτόχρονα αλλάξτε το μέγεθός του σε 4100 MB. Πατήστε
        ***![](../gparted/Gparted-apply-new-partition.png#inline) Εφαρμογή όλων
        των εργασιών***.

    2.  **Αυξήστε** το μεγέθους του Linux partition ***/dev/sdx1*** ώστε να
        καταλαμβάνει όλο τον διαθέσιμο δίσκο και ξαναπατήστε
        ***![](../gparted/Gparted-apply-new-partition.png#inline) Εφαρμογή
        όλων των εργασιών***.

Ο υπολογιστής-στόχος είναι έτοιμος. Μπορείτε να κάνετε επανεκκίνηση ώστε να
ελέγξετε ότι είναι λειτουργικός.

!!! info "Πληροφορία"
    Η κλωνοποίηση μπορεί να είναι χρήσιμη σε πολύ περισσότερα σενάρια πέρα από
    το LTSP, για παράδειγμα η πηγή μπορεί να είναι ένα live USB stick ή ο
    προορισμός ένας δίσκος σε θήκη USB. Για περισσότερες πληροφορίες / απορίες
    / διευκρινήσεις επισκεφτείτε:

    -   [Κλωνοποίηση εγκαταστάσεων Linux/Windows](https://alkisg.mysch.gr/steki/index.php?topic=7658.0)
    -   [Κλωνοποίηση δίσκου UEFI](https://alkisg.mysch.gr/steki/index.php?topic=8762.0)
    -   [Απομακρυσμένη κλωνοποίηση δίσκου από ΠΛΗΝΕΤ σε
        σχολείο](https://alkisg.mysch.gr/steki/index.php?topic=8602.0)
